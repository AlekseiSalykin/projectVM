<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mapping</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        span {
            font-family: sans-serif;
            font-style: italic;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #333;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 8px 16px;
            cursor: pointer;
            border: 1px solid #333;
            background-color: #fff;
            border-radius: 3px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background-color: #f0f0f0;
        }
        
        .main {
            display: flex;
            gap: 20px;
            height: 70vh;
            width: 100%;
        }
        
        .source-container {
            border: 2px solid #333;
            width: 40%;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ccc;
            background-color: #f8f9fa;
        }
        
        .mapping-container {
            border: 2px solid #333;
            width: 20%;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .mapping-container h2 {
            padding: 15px;
            margin: 0;
            border-bottom: 1px solid #ccc;
            background-color: #f8f9fa;
            text-align: center;
        }
        
        .target-container {
            border: 2px solid #333;
            width: 40%;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .target-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ccc;
            background-color: #f8f9fa;
        }
        
        .modal {
            display: none;
            position: absolute;
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 5px;
            border: 2px solid #333;
            padding: 20px;
            z-index: 1000;
            min-width: 300px;
        }
        
        .modalElemet {
            margin: 15px 0;
        }
        
        .node-structure {
            display: flex;
            align-items: center;
            padding: 10px;
            gap: 20px;
            border-bottom: 1px solid #ccc;
        }
        
        .node-children {
            margin-left: 20px;
            border-left: 1px dashed #ccc;
            padding-left: 10px;
        }
        
        .tree-node {
            position: relative;
            padding: 5px;
            margin: 2px 0;
            cursor: pointer;
        }
        
        .tree-node.selected {
            background-color: #e8e8e8;
            border-left: 3px solid #333;
        }
        
        .mapping-item {
            padding: 10px;
            margin: 5px 8px;
            border: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .mapping-item:hover {
            background-color: #f5f5f5;
        }
        
        .mapping-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-right: 10px;
        }
        
        .mapping-source, .mapping-target {
            font-size: 12px;
            font-family: monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #333;
        }
        
        .mapping-arrow {
            text-align: center;
            font-size: 12px;
            margin: 2px 0;
            color: #666;
        }
        
        .delete-mapping-btn {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border: none;
            background-color: transparent;
            color: #333;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: color 0.2s;
        }
        
        .delete-mapping-btn:hover {
            color: #ff0000;
        }
        
        .node-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
        }
        
        .tree-container {
            flex: 1;
            overflow: auto;
            padding: 10px;
        }
        
        .mapping {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .no-mappings {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #888;
            font-size: 14px;
            text-align: center;
            padding: 40px 20px;
        }
        
        input, select {
            padding: 8px;
            border: 1px solid #333;
            border-radius: 3px;
            width: 100%;
            margin-top: 5px;
        }
        
        label {
            font-weight: 500;
            color: #333;
        }
        
        h1, h2, h3 {
            color: #333;
            margin: 0;
        }
        
        h1 {
            font-size: 24px;
        }
        
        h2 {
            font-size: 18px;
        }
        
        h3 {
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        small {
            color: #666;
            font-size: 11px;
        }
        
        .add-field-btn, .delete-btn {
            padding: 4px 8px;
            font-size: 12px;
            min-width: 24px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–ú–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö</h1>
        <div class="controls">
            <button id="saveBtn" class="save-mapping">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</button>
            <button id="loadBtn" class="open-mapping">–û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</button>
        </div>
    </div>

    <div class="main">
        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—É–∫—Ç—É—Ä—ã -->
        <div class="source-container">
            <div class="source-header">
                <h2>–ò—Å—Ö–æ–¥—è—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</h2>
                <button class="add-strct" data-container="Source" id="createSource">–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
            </div>
            <div class="tree-container" id="treeSource">
            </div>
        </div>

        <div class="mapping-container">
            <h2>–ú–∞–ø–ø–∏–Ω–≥</h2>
            <div class="mapping" id="mappingsList">
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã -->
        <div class="target-container">
            <div class="target-header">
                <h2>–¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</h2>
                <button class="add-strct" data-container="Target" id="createTarget">–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
            </div>
            <div class="tree-container" id="treeTarget">
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã -->
    <div class="modal" id="structureModal">
        <h3>–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h3>
        <div class="modalElemet">
            <label>–ò–º—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:</label>
            <input type="text" id="structureName">
        </div>
        <div class="modalElemet">
            <button id="modalCancel">–û—Ç–º–µ–Ω–∞</button>
            <button id="modalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è -->
    <div class="modal" id="fieldModal">
        <h3>–ù–æ–≤–æ–µ –ø–æ–ª–µ</h3>
        <div class="modalElemet">
            <label>–ò–º—è –ø–æ–ª—è:</label>
            <input type="text" id="fieldName">
        </div>
        <div class="modalElemet">
            <label>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:</label>
            <select id="fieldType">
                <option value="string">–°—Ç—Ä–æ–∫–∞</option>
                <option value="number">–ß–∏—Å–ª–æ</option>
                <option value="boolean">–õ–æ–≥–∏—á–µ—Å–∫–∏–π</option>
                <option value="object">–û–±—ä–µ–∫—Ç</option>
                <option value="array">–ú–∞—Å—Å–∏–≤</option>
            </select>
        </div>
        <div class="modalElemet">
            <button id="fieldModalCancel">–û—Ç–º–µ–Ω–∞</button>
            <button id="fieldModalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <script>
        function updateMappingsList() {
            const mappingsList = document.getElementById('mappingsList');
            mappingsList.innerHTML = '';
            
            if (mappings.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'no-mappings';
                emptyState.innerHTML = `
                    <div>üìã</div>
                    <div>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π</div>
                    <div style="font-size: 12px; margin-top: 10px;">
                        –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ,<br>–∑–∞—Ç–µ–º –ø–æ–ª–µ –≤ —Ü–µ–ª–µ–≤–æ–π
                    </div>
                `;
                mappingsList.appendChild(emptyState);
                return;
            }
            
            mappings.forEach((mapping, index) => {
                const mappingItem = document.createElement('div');
                mappingItem.className = 'mapping-item';
                
                mappingItem.innerHTML = `
                    <div class="mapping-content">
                        <div class="mapping-source" title="${mapping.source}">
                            ${truncateText(mapping.source, 25)}
                        </div>
                        <div class="mapping-arrow">‚Üí</div>
                        <div class="mapping-target" title="${mapping.target}">
                            ${truncateText(mapping.target, 25)}
                        </div>
                    </div>
                    <button class="delete-mapping-btn" onclick="deleteMapping(${index})" title="–£–¥–∞–ª–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ">
                        üóëÔ∏è
                    </button>
                `;
                
                mappingsList.appendChild(mappingItem);
            });
        }
        
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength - 3) + '...';
        }
        
        let currentContainer = null;
        let selectedNode = null;
        let lastSelectedNode = null;
        let mappings = [];

        const sourceStructure = { name: '', fields: [] };
        const targetStructure = { name: '', fields: [] };

        document.addEventListener('DOMContentLoaded', function() {
            
            document.querySelectorAll('.add-strct').forEach( btn => {
                btn.addEventListener('click', function() {
                    currentContainer = this.getAttribute('data-container');
                    document.getElementById('structureModal').style.display = 'block';
                });
            });

            document.getElementById('modalCancel').addEventListener('click', function() {
                document.getElementById('structureModal').style.display = 'none';
            });

            document.getElementById('modalSave').addEventListener('click', function() {
                const name = document.getElementById('structureName').value.trim();
                if (name) {
                    createStructure(currentContainer, name);
                    document.getElementById('structureModal').style.display = 'none';
                    document.getElementById('structureName').value = '';
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã');
                }
                if (currentContainer === 'Source')
                {
                    document.getElementById('createSource').style.display = 'none';
                }
                else
                {
                    document.getElementById('createTarget').style.display = 'none';
                }
            });

            document.getElementById('fieldModalCancel').addEventListener('click', function() {
                document.getElementById('fieldModal').style.display = 'none';
            });

            document.getElementById('fieldModalSave').addEventListener('click', function() {
                const name = document.getElementById('fieldName').value.trim();
                const type = document.getElementById('fieldType').value;
                if (name) {
                    createField(selectedNode, name, type);
                    document.getElementById('fieldModal').style.display = 'none';
                    document.getElementById('fieldName').value = '';
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—è');
                }
            });

            document.getElementById('saveBtn').addEventListener('click', saveMapping);
            document.getElementById('loadBtn').addEventListener('click', function() {
                alert('–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ');
            });     
        });
        
        function createStructure(container, name) {
            const treeContainer = document.getElementById('tree' + container);

            console.log(container);

            treeContainer.innerHTML = '';
            const structureNode = document.createElement('div');
            structureNode.className = 'tree-node';
            structureNode.setAttribute('data-container', container);
            structureNode.setAttribute('data-path', name);
            structureNode.setAttribute('data-type', 'structure');
            structureNode.innerHTML = `
                <div class="node-structure">
                    <span>${name}</span>
                    <button class="add-field-btn">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ</button>
                </div>
                <div class="node-children"></div>
            `;


            treeContainer.appendChild(structureNode);
            
            if (container === 'Source') {
                sourceStructure.name = name;
                sourceStructure.fields = [];
                console.log(sourceStructure);
            } else {
                targetStructure.name = name;
                targetStructure.fields = [];
                console.log(targetStructure);
            }
            
            const addFieldBtn = structureNode.querySelector('.add-field-btn');
            addFieldBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                selectedNode = structureNode;
                document.getElementById('fieldModal').style.display = 'block';
                document.getElementById('fieldName').focus();
            });

            structureNode.addEventListener('click', function(e) {
                e.stopPropagation();
                if (e.target !== addFieldBtn && !e.target.classList.contains('add-field-btn')) {
                    handleNodeSelection(this);
                }
            });
        }

        function createField(node, name, type) {
            const childrenContainer = node.querySelector('.node-children');
            const container = node.getAttribute('data-container');
            const parentPath = node.getAttribute('data-path');
            const fieldPath = parentPath + '.' + name;
            
            const fieldNode = document.createElement('div');
            fieldNode.className = 'tree-node';
            fieldNode.setAttribute('data-container', container);
            fieldNode.setAttribute('data-path', fieldPath);
            fieldNode.setAttribute('data-type', type);
            fieldNode.setAttribute('data-name', name);

            const canHaveChildren = type === 'object' || type === 'array';

            fieldNode.innerHTML = `
                <div class="node-content">
                    <span>${name} <small>(${type})</small></span>
                    ${canHaveChildren ? '<button class="add-field-btn">+</button>' : ''}
                    <button class="delete-btn">-</button>
                </div>
                ${canHaveChildren ? '<div class="node-children"></div>' : ''}
            `;
            
            childrenContainer.appendChild(fieldNode);

            const field = {name, type, path: fieldPath, children: []};
            if(container == 'Source') {
                addFieldToStructure(sourceStructure, node, field);
            } else {
                addFieldToStructure(targetStructure, node, field);
            }
            console.log(JSON.stringify(field));

            if (canHaveChildren) {
                const addFieldBtn = fieldNode.querySelector('.add-field-btn');
                addFieldBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectedNode = fieldNode;
                    document.getElementById('fieldModal').style.display = 'block';
                    document.getElementById('fieldName').focus();
                });
            }

            const deleteBtn = fieldNode.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                deleteField(fieldNode);
            });

            fieldNode.addEventListener('click', function(e) {
                e.stopPropagation();
                if (!e.target.classList.contains('add-field-btn')) {
                    handleNodeSelection(this);
                }
            });
        }

        function addFieldToStructure(structure, parentNode, field) {
            const parentPath = parentNode.getAttribute('data-path');
            
            if (parentPath === structure.name) {
                structure.fields.push(field);
            } else {
                const parentField = findFieldByPath(structure.fields, parentPath);
                if (parentField) {
                    parentField.children.push(field);
                }
            }
        }
        
        function findFieldByPath(fields, path) {
            for (const field of fields) {
                if (field.path === path) {
                    return field;
                }
                if (field.children && field.children.length > 0) {
                    const found = findFieldByPath(field.children, path);
                    if (found) return found;
                }
            }
            return null;
        }

        function deleteField(node) {
            const container = node.getAttribute('data-container');
            const path = node.getAttribute('data-path');
            const type = node.getAttribute('data-type');
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ "${node.getAttribute('data-name')}" –∏ –≤—Å–µ –µ–≥–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è?`)) {
                return;
            }
            
            if (container === 'Source') {
                removeFieldFromStructure(sourceStructure, path);
            } else {
                removeFieldFromStructure(targetStructure, path);
            }
            
            node.remove();
            
            removeMappingsByPath(path);
            
            console.log(`–ü–æ–ª–µ ${path} —É–¥–∞–ª–µ–Ω–æ`);
        }

        function removeFieldFromStructure(structure, path) {
            for (let i = 0; i < structure.fields.length; i++) {
                if (structure.fields[i].path === path) {
                    structure.fields.splice(i, 1);
                    return true;
                }
                
                if (structure.fields[i].children && removeFieldFromChildren(structure.fields[i].children, path)) {
                    return true;
                }
            }
            return false;
        }

        function removeFieldFromChildren(children, path) {
            for (let i = 0; i < children.length; i++) {
                if (children[i].path === path) {
                    children.splice(i, 1);
                    return true;
                }
                
                if (children[i].children && removeFieldFromChildren(children[i].children, path)) {
                    return true;
                }
            }
            return false;
        }

        function removeMappingsByPath(path) {
            const initialLength = mappings.length;
            
            mappings = mappings.filter(mapping => {
                return !mapping.source.startsWith(path) && !mapping.target.startsWith(path);
            });
            
            if (mappings.length !== initialLength) {
                updateMappingsList();
            }
        }

        function createMapping(sourceNode, targetNode) {
            const sourcePath = sourceNode.getAttribute('data-path');
            const targetPath = targetNode.getAttribute('data-path');
            const sourceName = sourceNode.getAttribute('data-name');
            const targetName = targetNode.getAttribute('data-name');
            const sourceType = sourceNode.getAttribute('data-type');
            const targetType = targetNode.getAttribute('data-type');
            
            if (sourceType === 'object' || sourceType === 'structure') {
                alert('–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞, –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ.');
                return;
            }
            
            if (targetType === 'object' || targetType === 'structure') {
                alert('–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞, –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ.');
                return;
            }
            
            const existingMapping = mappings.find(m => m.source === sourcePath && m.target === targetPath);
            if (existingMapping) {
                alert('–≠—Ç–æ—Ç –º–∞–ø–ø–∏–Ω–≥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }
            
            const mapping = { 
                source: sourcePath, 
                target: targetPath,
                sourceName: sourceName,
                targetName: targetName
            };
            mappings.push(mapping);
            
            updateMappingsList();

            sourceNode.classList.remove('selected');
            targetNode.classList.remove('selected');
            
            console.log('–°–æ–∑–¥–∞–Ω –º–∞–ø–ø–∏–Ω–≥:', mapping);
        }

        function deleteMapping(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞–ø–ø–∏–Ω–≥?')) {
                mappings.splice(index, 1);
                updateMappingsList();
            }
        }

        function handleNodeSelection(node) {
            const container = node.getAttribute('data-container');
            const nodeType = node.getAttribute('data-type');
            
            document.querySelectorAll(`.tree-node.selected`).forEach(n => {
                n.classList.remove('selected');
            });
            
            node.classList.add('selected');

            if (nodeType === 'object' || nodeType === 'array' || nodeType === 'structure') {
                selectedNode = node;
                lastSelectedNode = null;
                console.log('–í—ã–±—Ä–∞–Ω —É–∑–µ–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π:', node.getAttribute('data-path'));
                return;
            }
            
            selectedNode = node;
            
            if (!lastSelectedNode) {
                lastSelectedNode = node;
                console.log('–í—ã–±—Ä–∞–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞:', node.getAttribute('data-path'));
            } else if (lastSelectedNode.getAttribute('data-container') !== container) {
                console.log('–°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ –º–µ–∂–¥—É:', lastSelectedNode.getAttribute('data-path'), '–∏', node.getAttribute('data-path'));
                createMapping(lastSelectedNode, node);
                lastSelectedNode = null;
            } else {
                console.log('–ó–∞–º–µ–Ω–µ–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞:', node.getAttribute('data-path'));
                lastSelectedNode = node;
            }
        }

        function generateMappingJson() {
            if (!sourceStructure.name || !targetStructure.name) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –æ–±–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π!');
                return null;
            }
            
            const mappingJson = {
                sourceSchema: sourceStructure,
                targetSchema: targetStructure,
                mappings: []
            };
            
            mappings.forEach(mapping => {
                mappingJson.mappings.push({
                    sourceField: mapping.source,
                    targetField: mapping.target,
                    transformation: ""
                });
            });
            
            return mappingJson;
        }

        async function saveMapping() {
            const mappingJson = generateMappingJson();
            
            if (!mappingJson) {
                return;
            }
            
            console.log('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON:', mappingJson);

            const dataToSend = {
                mapping: mappingJson,
                sourceStructure: sourceStructure,
                targetStructure: targetStructure
            };
            
            try {
                const response = await fetch('http://localhost:8080/apimapping', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(mappingJson)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!');
                    console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                } else {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: ' + error.message);
            }
        }

        window.deleteMapping = deleteMapping;
        window.deleteField = deleteField;
        window.truncateText = truncateText;
    </script>
</body>
</html>